"use strict";window.RTCMultiConnection=function(e,n){function t(e,n){var t="";t+="?userid="+e.userid,t+="&sessionid="+e.sessionid,t+="&msgEvent="+e.socketMessageEvent,t+="&socketCustomEvent="+e.socketCustomEvent,t+="&autoCloseEntireSession="+!!e.autoCloseEntireSession,!0===e.session.broadcast&&(t+="&oneToMany=true"),t+="&maxParticipantsAllowed="+e.maxParticipantsAllowed,e.enableScalableBroadcast&&(t+="&enableScalableBroadcast=true",t+="&maxRelayLimitPerUser="+(e.maxRelayLimitPerUser||2)),e.socketCustomParameters&&(t+=e.socketCustomParameters);try{io.sockets={}}catch(e){}if(e.socketURL||(e.socketURL="/"),"/"!=e.socketURL.substr(e.socketURL.length-1,1))throw'"socketURL" MUST end with a slash.';e.enableLogs&&("/"==e.socketURL?console.info("socket.io is connected at: ",location.origin+"/"):console.info("socket.io is connected at: ",e.socketURL));try{e.socket=io(e.socketURL+t)}catch(n){e.socket=io.connect(e.socketURL+t,e.socketOptions)}e.socket.isIO=!0;var o=e.multiPeersHandler;e.socket.on("extra-data-updated",function(n,t){e.peers[n]&&(e.peers[n].extra=t,e.onExtraDataUpdated({userid:n,extra:t}),e.peersBackup[n]||(e.peersBackup[n]={userid:n,extra:{}}),e.peersBackup[n].extra=t)}),e.socket.on(e.socketMessageEvent,function(n){if(n.remoteUserId==e.userid){if(e.peers[n.sender]&&e.peers[n.sender].extra!=n.message.extra&&(e.peers[n.sender].extra=n.extra,e.onExtraDataUpdated({userid:n.sender,extra:n.extra})),n.message.streamSyncNeeded&&e.peers[n.sender]){var t=e.streamEvents[n.message.streamid];if(!t||!t.stream)return;var i=n.message.action;return"ended"===i||"inactive"===i||"stream-removed"===i?(e.peersBackup[t.userid]&&(t.extra=e.peersBackup[t.userid].extra),void e.onstreamended(t)):void("function"==typeof t.stream[i]&&t.stream[i]("both"!=n.message.type?n.message.type:null))}if("connectWithAllParticipants"===n.message)return-1===e.broadcasters.indexOf(n.sender)&&e.broadcasters.push(n.sender),void o.onNegotiationNeeded({allParticipants:e.getAllParticipants(n.sender)},n.sender);if("removeFromBroadcastersList"!==n.message)if("dropPeerConnection"!==n.message){if(n.message.allParticipants)return-1===n.message.allParticipants.indexOf(n.sender)&&n.message.allParticipants.push(n.sender),void n.message.allParticipants.forEach(function(n){o[e.peers[n]?"renegotiatePeer":"createNewPeer"](n,{localPeerSdpConstraints:{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:c(e.session)})});if(n.message.newParticipant){if(n.message.newParticipant==e.userid)return;if(e.peers[n.message.newParticipant])return;o.createNewPeer(n.message.newParticipant,n.message.userPreferences||{localPeerSdpConstraints:{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:c(e.session)})}else if((n.message.readyForOffer||n.message.addMeAsBroadcaster)&&e.addNewBroadcaster(n.sender),n.message.newParticipationRequest&&n.sender!==e.userid){e.peers[n.sender]&&e.deletePeer(n.sender);var r={extra:n.extra||{},localPeerSdpConstraints:n.message.remotePeerSdpConstraints||{OfferToReceiveAudio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:n.message.localPeerSdpConstraints||{OfferToReceiveAudio:e.session.oneway?!!e.session.audio:e.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:e.session.oneway?!!e.session.video||!!e.session.screen:e.sdpConstraints.mandatory.OfferToReceiveVideo},isOneWay:"undefined"!=typeof n.message.isOneWay?n.message.isOneWay:!!e.session.oneway||"one-way"===e.direction,isDataOnly:"undefined"!=typeof n.message.isDataOnly?n.message.isDataOnly:c(e.session),dontGetRemoteStream:"undefined"!=typeof n.message.isOneWay?n.message.isOneWay:!!e.session.oneway||"one-way"===e.direction,dontAttachLocalStream:!!n.message.dontGetRemoteStream,connectionDescription:n,successCallback:function(){("undefined"!=typeof n.message.isOneWay?n.message.isOneWay:e.session.oneway||"one-way"===e.direction)&&e.addNewBroadcaster(n.sender,r),(e.session.oneway||"one-way"===e.direction||c(e.session))&&e.addNewBroadcaster(n.sender,r)}};e.onNewParticipant(n.sender,r)}else if(n.message.shiftedModerationControl)e.onShiftedModerationControl(n.sender,n.message.broadcasters);else{if(n.message.changedUUID&&e.peers[n.message.oldUUID]&&(e.peers[n.message.newUUID]=e.peers[n.message.oldUUID],delete e.peers[n.message.oldUUID]),n.message.userLeft)return o.onUserLeft(n.sender),void(n.message.autoCloseEntireSession&&e.leave());o.addNegotiatedMessage(n.message,n.sender)}}else e.deletePeer(n.sender);else-1!==e.broadcasters.indexOf(n.sender)&&(delete e.broadcasters[e.broadcasters.indexOf(n.sender)],e.broadcasters=d(e.broadcasters))}}),e.socket.on("user-left",function(n){onUserLeft(n),e.onUserStatusChanged({userid:n,status:"offline",extra:e.peers[n]&&e.peers[n].extra||{}});var t={userid:n,extra:{}};e.peersBackup[t.userid]&&(t.extra=e.peersBackup[t.userid].extra),e.onleave(t)});var i=!1;e.socket.resetProps=function(){i=!1},e.socket.on("connect",function(){i||(i=!0,e.enableLogs&&console.info("socket.io connection is opened."),setTimeout(function(){e.socket.emit("extra-data-updated",e.extra),n&&n(e.socket)},1e3))}),e.socket.on("disconnect",function(){e.enableLogs&&console.warn("socket.io connection is closed")}),e.socket.on("join-with-password",function(n){e.onJoinWithPassword(n)}),e.socket.on("invalid-password",function(n,t){e.onInvalidPassword(n,t)}),e.socket.on("password-max-tries-over",function(n){e.onPasswordMaxTriesOver(n)}),e.socket.on("user-disconnected",function(n){n!==e.userid&&(e.onUserStatusChanged({userid:n,status:"offline",extra:e.peers[n]&&e.peers[n].extra||{}}),e.deletePeer(n))}),e.socket.on("user-connected",function(n){n!==e.userid&&e.onUserStatusChanged({userid:n,status:"online",extra:e.peers[n]&&e.peers[n].extra||{}})}),e.socket.on("closed-entire-session",function(n,t){e.leave(),e.onEntireSessionClosed({sessionid:n,userid:n,extra:t})}),e.socket.on("userid-already-taken",function(n,t){e.isInitiator=!1,e.userid=t,e.onUserIdAlreadyTaken(n,t)}),e.socket.on("logs",function(n){e.enableLogs&&console.debug("server-logs",n)}),e.socket.on("number-of-broadcast-viewers-updated",function(n){e.onNumberOfBroadcastViewersUpdated(n)}),e.socket.on("room-full",function(n){e.onRoomFull(n)}),e.socket.on("become-next-modrator",function(n){n==e.sessionid&&setTimeout(function(){e.open(n),e.socket.emit("shift-moderator-control-on-disconnect")},1e3)})}function o(e,n,t){if("undefined"!=typeof CustomEvent){var o=new CustomEvent(n,{arguments:t,__exposedProps__:t});e.dispatchEvent(o)}}function i(e,n){n.stream&&n.stream&&n.stream.addEventListener&&(n.stream.addEventListener("mute",function(t){(t=e.streamEvents[n.streamid]).session={audio:"audio"===t.muteType,video:"video"===t.muteType},e.onmute(t)},!1),n.stream.addEventListener("unmute",function(t){(t=e.streamEvents[n.streamid]).session={audio:"audio"===t.unmuteType,video:"video"===t.unmuteType},e.onunmute(t)},!1))}function r(){if(window.crypto&&window.crypto.getRandomValues&&-1===navigator.userAgent.indexOf("Safari")){for(var e=window.crypto.getRandomValues(new Uint32Array(3)),n="",t=0,o=e.length;t<o;t++)n+=e[t].toString(36);return n}return(Math.random()*(new Date).getTime()).toString(36).replace(/\./g,"")}function s(e,n,t){if(t.autoCreateMediaElement){var o=!1;!e.getVideoTracks||e.getVideoTracks().length||e.isVideo||e.isScreen||(o=!0),"Firefox"===DetectRTC.browser.name&&(t.session.video||t.session.screen)&&(o=!1);var i=document.createElement(o?"audio":"video");if(i.srcObject=e,i.controls=!0,"Firefox"===DetectRTC.browser.name){var r="ended";"oninactive"in i&&(r="inactive"),i.addEventListener(r,function(){if(currentUserMediaRequest.remove(e.idInstance),"local"===e.type){r="ended","oninactive"in e&&(r="inactive"),x.onSyncNeeded(e.streamid,r),t.attachStreams.forEach(function(n,o){e.streamid===n.streamid&&delete t.attachStreams[o]});var n=[];t.attachStreams.forEach(function(e){e&&n.push(e)}),t.attachStreams=n;var o=t.streamEvents[e.streamid];if(o)return void t.onstreamended(o);this.parentNode&&this.parentNode.removeChild(this)}},!1)}var s=i.play();if("undefined"!=typeof s){var a=!1;setTimeout(function(){a||(a=!0,n(i))},1e3),s.then(function(){a||(a=!0,n(i))}).catch(function(e){a||(a=!0,n(i))})}else n(i)}else n({})}function a(e,n){window.removeEventListener(e,n),window.addEventListener(e,n,!1)}function d(e){var n=[];return e.forEach(function(e){e&&n.push(e)}),n}function c(e){return!e.audio&&!e.video&&!e.screen&&e.data}function u(e){return"undefined"==typeof e}!function(){var e,n="Fake/5.0 (FakeOS) AppleWebKit/123 (KHTML, like Gecko) Fake/12.3.4567.89 Fake/123.45";if("object"==typeof process&&"object"==typeof process.versions&&process.versions.node&&!process.browser){var t=process.versions.node.toString().replace("v","");n="Nodejs/"+t+" (NodeOS) AppleWebKit/"+t+" (KHTML, like Gecko) Nodejs/"+t+" Nodejs/"+t}e="undefined"!=typeof global?global:window,"undefined"==typeof window&&("undefined"==typeof window&&"undefined"!=typeof global&&(global.navigator={userAgent:n,getUserMedia:function(){}},e.window=global),"undefined"==typeof location&&(e.location={protocol:"file:",href:"",hash:""}),"undefined"==typeof screen&&(e.screen={width:0,height:0}));var o=window.navigator;"undefined"!=typeof o?("undefined"!=typeof o.webkitGetUserMedia&&(o.getUserMedia=o.webkitGetUserMedia),"undefined"!=typeof o.mozGetUserMedia&&(o.getUserMedia=o.mozGetUserMedia)):o={getUserMedia:function(){},userAgent:n};var i=!!/Android|webOS|iPhone|iPad|iPod|BB10|BlackBerry|IEMobile|Opera Mini|Mobile|mobile/i.test(o.userAgent||""),r=!(-1===o.userAgent.indexOf("Edge")||!o.msSaveOrOpenBlob&&!o.msSaveBlob),s=!!window.opera||o.userAgent.indexOf(" OPR/")>=0,a="undefined"!=typeof window.InstallTrigger,d=/^((?!chrome|android).)*safari/i.test(o.userAgent),c=!!window.chrome&&!s,u="undefined"!=typeof document&&!!document.documentMode&&!r;function f(e,n){var t=0,o=!1,i=window.setInterval(function(){e()&&(window.clearInterval(i),n(o)),t++>50&&(window.clearInterval(i),n(o=!0))},10)}var m,l,p={Android:function(){return o.userAgent.match(/Android/i)},BlackBerry:function(){return o.userAgent.match(/BlackBerry|BB10/i)},iOS:function(){return o.userAgent.match(/iPhone|iPad|iPod/i)},Opera:function(){return o.userAgent.match(/Opera Mini/i)},Windows:function(){return o.userAgent.match(/IEMobile/i)},any:function(){return p.Android()||p.BlackBerry()||p.iOS()||p.Opera()||p.Windows()},getOsName:function(){var e="Unknown OS";return p.Android()&&(e="Android"),p.BlackBerry()&&(e="BlackBerry"),p.iOS()&&(e="iOS"),p.Opera()&&(e="Opera Mini"),p.Windows()&&(e="Windows"),e}},v="Unknown OS",g="Unknown OS Version",h=function(){for(var e,n=o.appVersion,t=o.userAgent,i="-",r=[{s:"Windows 10",r:/(Windows 10.0|Windows NT 10.0)/},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/},{s:"Windows Vista",r:/Windows NT 6.0/},{s:"Windows Server 2003",r:/Windows NT 5.2/},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/},{s:"Windows 98",r:/(Windows 98|Win98)/},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/},{s:"Windows CE",r:/Windows CE/},{s:"Windows 3.11",r:/Win16/},{s:"Android",r:/Android/},{s:"Open BSD",r:/OpenBSD/},{s:"Sun OS",r:/SunOS/},{s:"Linux",r:/(Linux|X11)/},{s:"iOS",r:/(iPhone|iPad|iPod)/},{s:"Mac OS X",r:/Mac OS X/},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/},{s:"QNX",r:/QNX/},{s:"UNIX",r:/UNIX/},{s:"BeOS",r:/BeOS/},{s:"OS/2",r:/OS\/2/},{s:"Search Bot",r:/(nuhk|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask Jeeves\/Teoma|ia_archiver)/}],s=0;e=r[s];s++)if(e.r.test(t)){i=e.s;break}var a="-";switch(/Windows/.test(i)&&(/Windows (.*)/.test(i)&&(a=/Windows (.*)/.exec(i)[1]),i="Windows"),i){case"Mac OS X":/Mac OS X (10[\.\_\d]+)/.test(t)&&(a=/Mac OS X (10[\.\_\d]+)/.exec(t)[1]);break;case"Android":/Android ([\.\_\d]+)/.test(t)&&(a=/Android ([\.\_\d]+)/.exec(t)[1]);break;case"iOS":/OS (\d+)_(\d+)_?(\d+)?/.test(t)&&(a=(a=/OS (\d+)_(\d+)_?(\d+)?/.exec(n))[1]+"."+a[2]+"."+(0|a[3]))}return{osName:i,osVersion:a}}();h&&h.osName&&"-"!=h.osName?(v=h.osName,g=h.osVersion):p.any()&&"Android"==(v=p.getOsName())&&(g=!!(l=(m=(m||o.userAgent).toLowerCase()).match(/android\s([0-9\.]*)/))&&l[1]);var w="object"==typeof process&&"object"==typeof process.versions&&process.versions.node;"Unknown OS"===v&&w&&(v="Nodejs",g=process.versions.node.toString().replace("v",""));var S=!1,y=!1;["captureStream","mozCaptureStream","webkitCaptureStream"].forEach(function(e){"undefined"!=typeof document&&"function"==typeof document.createElement&&(!S&&e in document.createElement("canvas")&&(S=!0),!y&&e in document.createElement("video")&&(y=!0))});var b=[],k=[],T=[],R=[];o.mediaDevices&&o.mediaDevices.enumerateDevices&&(o.enumerateDevices=function(e){var n=o.mediaDevices.enumerateDevices();n&&n.then?o.mediaDevices.enumerateDevices().then(e).catch(function(){e([])}):e([])});var x=!1;"undefined"!=typeof C&&"getSources"in C?x=!0:o.mediaDevices&&o.mediaDevices.enumerateDevices&&(x=!0);var P=!1,E=!1,O=!1,M=!1,D=!1,A=window.DetectRTC||{};A.browser=function(){var e,n,t,i=o.userAgent,f=o.appName,m=""+parseFloat(o.appVersion),l=parseInt(o.appVersion,10);if(s){f="Opera";try{l=(m=o.userAgent.split("OPR/")[1].split(" ")[0]).split(".")[0]}catch(e){m="0.0.0.0",l=0}}else u?((n=i.indexOf("rv:"))>0?m=i.substring(n+3):(n=i.indexOf("MSIE"),m=i.substring(n+5)),f="IE"):c?(n=i.indexOf("Chrome"),f="Chrome",m=i.substring(n+7)):d?(n=i.indexOf("Safari"),f="Safari",m=i.substring(n+7),-1!==(n=i.indexOf("Version"))&&(m=i.substring(n+8)),-1!==o.userAgent.indexOf("Version/")&&(m=o.userAgent.split("Version/")[1].split(" ")[0])):a?(n=i.indexOf("Firefox"),f="Firefox",m=i.substring(n+8)):(e=i.lastIndexOf(" ")+1)<(n=i.lastIndexOf("/"))&&(f=i.substring(e,n),m=i.substring(n+1),f.toLowerCase()===f.toUpperCase()&&(f=o.appName));return r&&(f="Edge",m=o.userAgent.split("Edge/")[1]),-1!==(t=m.search(/[; \)]/))&&(m=m.substring(0,t)),l=parseInt(""+m,10),isNaN(l)&&(m=""+parseFloat(o.appVersion),l=parseInt(o.appVersion,10)),{fullVersion:m,version:l,name:f,isPrivateBrowsing:!1}}(),function(e){var n;try{if(window.webkitRequestFileSystem)window.webkitRequestFileSystem(window.TEMPORARY,1,function(){n=!1},function(e){n=!0});else if(window.indexedDB&&/Firefox/.test(window.navigator.userAgent)){var t;try{(t=window.indexedDB.open("test")).onerror=function(){return!0}}catch(e){n=!0}"undefined"==typeof n&&f(function(){return"done"===t.readyState},function(e){e||(n=!t.result)})}else if(function(e){var n=window.navigator.userAgent.toLowerCase();if(0===n.indexOf("msie")&&0===n.indexOf("trident"))return!1;var t=/(?:msie|rv:)\s?([\d\.]+)/.exec(n);return!!(t&&parseInt(t[1],10)>=10)}()){n=!1;try{window.indexedDB||(n=!0)}catch(e){n=!0}}else if(window.localStorage&&/Safari/.test(window.navigator.userAgent)){try{window.localStorage.setItem("test",1)}catch(e){n=!0}"undefined"==typeof n&&(n=!1,window.localStorage.removeItem("test"))}}catch(e){n=!1}f(function(){return"undefined"!=typeof n},function(e){A.browser.isPrivateBrowsing=!!n})}(),A.browser["is"+A.browser.name]=!0,A.osName=v,A.osVersion=g,"object"==typeof process&&"object"==typeof process.versions&&process;var U=!1;["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach(function(e){U||e in window&&(U=!0)}),A.isWebRTCSupported=U,A.isORTCSupported="undefined"!=typeof RTCIceGatherer;var L=!1;A.browser.isChrome&&A.browser.version>=35?L=!0:A.browser.isFirefox&&A.browser.version>=34&&(L=!0),/^(https:|chrome-extension:)$/g.test(location.protocol||"")||("undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(L=!1),A.browser.isFirefox&&(L=!1)),A.isScreenCapturingSupported=L;var N={isSupported:!1,isCreateMediaStreamSourceSupported:!1};["AudioContext","webkitAudioContext","mozAudioContext","msAudioContext"].forEach(function(e){N.isSupported||e in window&&(N.isSupported=!0,window[e]&&"createMediaStreamSource"in window[e].prototype&&(N.isCreateMediaStreamSourceSupported=!0))}),A.isAudioContextSupported=N.isSupported,A.isCreateMediaStreamSourceSupported=N.isCreateMediaStreamSourceSupported;var I=!1;A.browser.isChrome&&A.browser.version>31&&(I=!0),A.isRtpDataChannelsSupported=I;var W=!1;A.browser.isFirefox&&A.browser.version>28?W=!0:A.browser.isChrome&&A.browser.version>25?W=!0:A.browser.isOpera&&A.browser.version>=11&&(W=!0),A.isSctpDataChannelsSupported=W,A.isMobileDevice=i;var B=!1;o.getUserMedia?B=!0:o.mediaDevices&&o.mediaDevices.getUserMedia&&(B=!0),A.browser.isChrome&&A.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(B="Requires HTTPs"),"Nodejs"===A.osName&&(B=!1),A.isGetUserMediaSupported=B;var V,F,q,G="";screen.width&&(G+=(screen.width?screen.width:"")+" x "+(screen.height?screen.height:"")),A.displayResolution=G,A.displayAspectRatio=(V=screen.width,F=screen.height,q=function e(n,t){return 0==t?n:e(t,n%t)}(V,F),V/q/(F/q)).toFixed(2),A.isCanvasSupportsStreamCapturing=S,A.isVideoSupportsStreamCapturing=y,"Chrome"==A.browser.name&&A.browser.version>=53&&(A.isCanvasSupportsStreamCapturing||(A.isCanvasSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features"),A.isVideoSupportsStreamCapturing||(A.isVideoSupportsStreamCapturing="Requires chrome flag: enable-experimental-web-platform-features")),A.DetectLocalIPAddress=function(e,n){A.isWebRTCSupported&&function(e,n){if("undefined"!=typeof document&&"function"==typeof document.getElementById){var t={},o=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;if(!o){var i=document.getElementById("iframe");if(!i)return;var r=i.contentWindow;o=r.RTCPeerConnection||r.mozRTCPeerConnection||r.webkitRTCPeerConnection}if(o){var s=null;"Chrome"===A.browser&&A.browser.version<58&&(s={optional:[{RtpDataChannels:!0}]});var a=new o({iceServers:[{urls:"stun:stun.l.google.com:19302"}]},s);if(n&&(a.addStream?a.addStream(n):a.addTrack&&n.getTracks()[0]&&a.addTrack(n.getTracks()[0],n)),a.onicecandidate=function(e){e.candidate&&d(e.candidate.candidate)},!n)try{a.createDataChannel("sctp",{})}catch(e){}A.isPromisesSupported?a.createOffer().then(function(e){a.setLocalDescription(e).then(c)}):a.createOffer(function(e){a.setLocalDescription(e,c,function(){})},function(){})}}function d(n){var o=/([0-9]{1,3}(\.[0-9]{1,3}){3})/.exec(n);if(o){var i=o[1];void 0===t[i]&&e(i),t[i]=!0}}function c(){a.localDescription.sdp.split("\n").forEach(function(e){0===e.indexOf("a=candidate:")&&d(e)})}}(function(n){n.match(/^(192\.168\.|169\.254\.|10\.|172\.(1[6-9]|2\d|3[01]))/)?e("Local: "+n):e("Public: "+n)},n)},A.isWebSocketsSupported="WebSocket"in window&&2===window.WebSocket.CLOSING,A.isWebSocketsBlocked=!A.isWebSocketsSupported,"Nodejs"===A.osName&&(A.isWebSocketsSupported=!0,A.isWebSocketsBlocked=!1),A.checkWebSocketsSupport=function(e){e=e||function(){};try{var n,t=new WebSocket("wss://echo.websocket.org:443/");t.onopen=function(){A.isWebSocketsBlocked=!1,n=(new Date).getTime(),t.send("ping")},t.onmessage=function(){A.WebsocketLatency=(new Date).getTime()-n+"ms",e(),t.close(),t=null},t.onerror=function(){A.isWebSocketsBlocked=!0,e()}}catch(n){A.isWebSocketsBlocked=!0,e()}},A.load=function(e){!function(e){if(x)if(!o.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(o.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!o.enumerateDevices&&o.enumerateDevices&&(o.enumerateDevices=o.enumerateDevices.bind(o)),o.enumerateDevices){b=[],k=[],T=[],R=[],P=!1,E=!1,O=!1,M=!1,D=!1;var n={};o.enumerateDevices(function(t){t.forEach(function(e){var t={};for(var o in e)try{"function"!=typeof e[o]&&(t[o]=e[o])}catch(e){}n[t.deviceId+t.label+t.kind]||("audio"===t.kind&&(t.kind="audioinput"),"video"===t.kind&&(t.kind="videoinput"),t.deviceId||(t.deviceId=t.id),t.id||(t.id=t.deviceId),t.label?("videoinput"!==t.kind||D||(D=!0),"audioinput"!==t.kind||M||(M=!0)):(t.isCustomLabel=!0,t.label="videoinput"===t.kind?"Camera "+(R.length+1):"audioinput"===t.kind?"Microphone "+(k.length+1):"audiooutput"===t.kind?"Speaker "+(T.length+1):"Please invoke getUserMedia once.","undefined"!=typeof A&&A.browser.isChrome&&A.browser.version>=46&&!/^(https:|chrome-extension:)$/g.test(location.protocol||"")&&"undefined"!=typeof document&&"string"==typeof document.domain&&document.domain.search&&-1===document.domain.search(/localhost|127.0./g)&&(t.label="HTTPs is required to get label of this "+t.kind+" device.")),"audioinput"===t.kind&&(P=!0,-1===k.indexOf(t)&&k.push(t)),"audiooutput"===t.kind&&(E=!0,-1===T.indexOf(t)&&T.push(t)),"videoinput"===t.kind&&(O=!0,-1===R.indexOf(t)&&R.push(t)),b.push(t),n[t.deviceId+t.label+t.kind]=t)}),"undefined"!=typeof A&&(A.MediaDevices=b,A.hasMicrophone=P,A.hasSpeakers=E,A.hasWebcam=O,A.isWebsiteHasWebcamPermissions=D,A.isWebsiteHasMicrophonePermissions=M,A.audioInputDevices=k,A.audioOutputDevices=T,A.videoInputDevices=R),e&&e()})}else e&&e();else e&&e()}(e=e||function(){})},A.MediaDevices="undefined"!=typeof b?b:[],A.hasMicrophone=P,A.hasSpeakers=E,A.hasWebcam=O,A.isWebsiteHasWebcamPermissions=D,A.isWebsiteHasMicrophonePermissions=M,A.audioInputDevices=k,A.audioOutputDevices=T,A.videoInputDevices=R;var j=!1;"undefined"!=typeof document&&"function"==typeof document.createElement&&"setSinkId"in document.createElement("video")&&(j=!0),A.isSetSinkIdSupported=j;var H=!1;A.browser.isFirefox&&"undefined"!=typeof mozRTCPeerConnection?"getSenders"in mozRTCPeerConnection.prototype&&(H=!0):A.browser.isChrome&&"undefined"!=typeof webkitRTCPeerConnection&&"getSenders"in webkitRTCPeerConnection.prototype&&(H=!0),A.isRTPSenderReplaceTracksSupported=H;var z=!1;A.browser.isFirefox&&A.browser.version>38&&(z=!0),A.isRemoteStreamProcessingSupported=z;var X=!1;"undefined"!=typeof C&&"applyConstraints"in C.prototype&&(X=!0),A.isApplyConstraintsSupported=X;var _=!1;A.browser.isFirefox&&A.browser.version>=43&&(_=!0),A.isMultiMonitorScreenCapturingSupported=_,A.isPromisesSupported=!!("Promise"in window),"undefined"==typeof A&&(window.DetectRTC={});var J=window.MediaStream;"undefined"==typeof J&&"undefined"!=typeof webkitMediaStream&&(J=webkitMediaStream),A.MediaStream="undefined"!=typeof J&&Object.keys(J.prototype),A.MediaStreamTrack="undefined"!=typeof C&&Object.keys(C.prototype);var K=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection;A.RTCPeerConnection="undefined"!=typeof K&&Object.keys(K.prototype),window.DetectRTC=A,"undefined"!=typeof module&&(module.exports=A),"function"==typeof define&&define.amd&&define("DetectRTC",[],function(){return A})}(),"undefined"!=typeof cordova&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Crosswalk")&&(DetectRTC.isMobileDevice=!0,DetectRTC.browser.name="Chrome"),window.addEventListener||(window.addEventListener=function(e,n,t){e.attachEvent&&e.attachEvent("on"+n,t)}),window.attachEventListener=function(e,n,t,o){e.addEventListener(n,t,o)};var f=window.MediaStream;function m(e,n){return!(e.session.audio&&"two-way"===e.session.audio||("Firefox"!==DetectRTC.browser.name||!1===n)&&("Chrome"!==DetectRTC.browser.name||DetectRTC.browser.version<50||!0!==typeof n&&("undefined"!=typeof n||!e.session.audio||!e.session.screen||e.session.video||(n=!0,0))))}function l(e){return"Firefox"===DetectRTC.browser.name||"Chrome"===DetectRTC.browser.name&&{mandatory:{chromeMediaSource:e.mandatory.chromeMediaSource,chromeMediaSourceId:e.mandatory.chromeMediaSourceId}}}function p(){if("undefined"!=typeof cordova&&"undefined"!=typeof cordova.plugins&&"undefined"!=typeof cordova.plugins.iosrtc){var e=cordova.plugins.iosrtc;window.webkitRTCPeerConnection=e.RTCPeerConnection,window.RTCSessionDescription=e.RTCSessionDescription,window.RTCIceCandidate=e.RTCIceCandidate,window.MediaStream=e.MediaStream,window.MediaStreamTrack=e.MediaStreamTrack,navigator.getUserMedia=navigator.webkitGetUserMedia=e.getUserMedia,e.debug.enable("iosrtc*"),"function"==typeof e.selectAudioOutput&&e.selectAudioOutput(window.iOSDefaultAudioOutputDevice||"speaker"),e.registerGlobals()}}"undefined"==typeof f&&"undefined"!=typeof webkitMediaStream&&(f=webkitMediaStream),"undefined"!=typeof f&&("getVideoTracks"in f.prototype&&"Firefox"!==DetectRTC.browser.name||(f.prototype.getVideoTracks=function(){if(!this.getTracks)return[];var e=[];return this.getTracks().forEach(function(n){-1!==n.kind.toString().indexOf("video")&&e.push(n)}),e},f.prototype.getAudioTracks=function(){if(!this.getTracks)return[];var e=[];return this.getTracks().forEach(function(n){-1!==n.kind.toString().indexOf("audio")&&e.push(n)}),e}),"stop"in f.prototype&&"Firefox"!==DetectRTC.browser.name||(f.prototype.stop=function(){this.getAudioTracks().forEach(function(e){e.stop&&e.stop()}),this.getVideoTracks().forEach(function(e){e.stop&&e.stop()})})),window.iOSDefaultAudioOutputDevice=window.iOSDefaultAudioOutputDevice||"speaker","undefined"==typeof window.enableAdapter&&("Firefox"===DetectRTC.browser.name&&DetectRTC.browser.version>=54&&(window.enableAdapter=!0),"Chrome"===DetectRTC.browser.name&&DetectRTC,"undefined"!=typeof adapter&&adapter.browserDetails&&"string"==typeof adapter.browserDetails.browser&&(window.enableAdapter=!0)),window.enableAdapter||("undefined"==typeof URL.createObjectURL&&(URL.createObjectURL=function(e){return"blob:https://"+document.domain+"/"+r()}),"srcObject"in HTMLMediaElement.prototype||(HTMLMediaElement.prototype.srcObject=function(e){"mozSrcObject"in this?this.mozSrcObject=e:this.src=URL.createObjectURL(e)})),document.addEventListener("deviceready",p,!1),p();var v,g={};function h(e){var n={OfferToReceiveAudio:!!e.OfferToReceiveAudio,OfferToReceiveVideo:!!e.OfferToReceiveVideo},t=!window.enableAdapter;return"Chrome"===DetectRTC.browser.name&&DetectRTC,"Firefox"===DetectRTC.browser.name&&DetectRTC.browser.version>=54&&(t=!1),t&&(n={mandatory:n,optional:[{VoiceActivityDetection:!1}]}),n}"undefined"!=typeof window.RTCPeerConnection?v=window.RTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?v=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection&&(v=webkitRTCPeerConnection);var w=window.RTCSessionDescription||window.mozRTCSessionDescription,S=window.RTCIceCandidate||window.mozRTCIceCandidate,C=window.MediaStreamTrack;function y(e){if("undefined"!=typeof window.RTCPeerConnection?v=window.RTCPeerConnection:"undefined"!=typeof mozRTCPeerConnection?v=mozRTCPeerConnection:"undefined"!=typeof webkitRTCPeerConnection&&(v=webkitRTCPeerConnection),w=window.RTCSessionDescription||window.mozRTCSessionDescription,S=window.RTCIceCandidate||window.mozRTCIceCandidate,C=window.MediaStreamTrack,!v)throw"WebRTC 1.0 (RTCPeerConnection) API are NOT available in this browser.";var n=e.rtcMultiConnection;this.extra=e.remoteSdp?e.remoteSdp.extra:n.extra,this.userid=e.userid,this.streams=[],this.channels=e.channels||[],this.connectionDescription=e.connectionDescription,this.addStream=function(e){n.addStream(e,t.userid)},this.removeStream=function(e){n.removeStream(e,t.userid)};var t=this;e.remoteSdp&&(this.connectionDescription=e.remoteSdp.connectionDescription);var i,r={};g.sdpConstraints=h({OfferToReceiveAudio:!0,OfferToReceiveVideo:!0});var s=!!e.renegotiatingPeer;e.remoteSdp&&(s=!!e.remoteSdp.renegotiatingPeer);var a=[];if(n.attachStreams.forEach(function(e){e&&a.push(e)}),s)i=e.peerRef;else{var d="all";(n.candidates.turn||n.candidates.relay)&&(n.candidates.stun||n.candidates.reflexive||n.candidates.host||(d="relay"));try{var c={};"Chrome"!==DetectRTC.browser.name&&(c.iceServers=n.iceServers),"Chrome"===DetectRTC.browser.name&&(c={iceServers:n.iceServers,iceTransportPolicy:n.iceTransportPolicy||d,bundlePolicy:"max-bundle",iceCandidatePoolSize:n.iceCandidatePoolSize||0}),n.iceServers.length||(c=null,n.optionalArgument=null),i=new v(c,n.optionalArgument)}catch(e){try{i=new v(c={iceServers:n.iceServers})}catch(e){i=new v}}}function u(){if("undefined"!=typeof window.InstallTrigger&&"getSenders"in i&&"function"==typeof i.getSenders){var e=new f;return i.getSenders().forEach(function(n){try{e.addTrack(n.track)}catch(e){}}),e}return i.getLocalStreams()}i.onicecandidate=function(o){if(o.candidate)n.trickleIce&&e.onLocalCandidate({candidate:o.candidate.candidate,sdpMid:o.candidate.sdpMid,sdpMLineIndex:o.candidate.sdpMLineIndex});else if(!n.trickleIce){var r=i.localDescription;e.onLocalSdp({type:r.type,sdp:r.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:t.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:n?n.extra:{},streamsToShare:k})}},a.forEach(function(o){if(!(e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.dontGetRemoteStream)&&!e.dontAttachLocalStream&&(o=n.beforeAddingStream(o,t)))if(u().forEach&&u().forEach(function(e){o&&e.id==o.id&&(o=null)}),o&&"function"==typeof i.addTrack)o.getTracks().forEach(function(e){try{i.addTrack(e,o)}catch(e){}});else if(o&&"function"==typeof i.addStream)i.addStream(o);else try{i.addStream(o)}catch(e){o&&o.getTracks().forEach(function(e){try{i.addTrack(e,o)}catch(e){}})}}),i.oniceconnectionstatechange=i.onsignalingstatechange=function(){var o=t.extra;n.peers[t.userid]&&(o=n.peers[t.userid].extra||o),i&&(e.onPeerStateChanged({iceConnectionState:i.iceConnectionState,iceGatheringState:i.iceGatheringState,signalingState:i.signalingState,extra:o,userid:t.userid}),i&&i.iceConnectionState&&-1!==i.iceConnectionState.search(/closed|failed/gi)&&t.streams instanceof Array&&t.streams.forEach(function(e){n.onstreamended(n.streamEvents[e.id]||{streamid:e.id,stream:e,type:"remote"})}))};var m={OfferToReceiveAudio:!!a.length,OfferToReceiveVideo:!!a.length};e.localPeerSdpConstraints&&(m=e.localPeerSdpConstraints),g.sdpConstraints=h(m);var l={},p="track";window.enableAdapter||(p="addstream"),i.addEventListener(p,function(n){if(n&&("track"===p&&(n.stream=n.streams[n.streams.length-1]),!l[n.stream.id]||"Safari"===DetectRTC.browser.name)){l[n.stream.id]=n.stream.id;var t={};e.remoteSdp&&e.remoteSdp.streamsToShare?t=e.remoteSdp.streamsToShare:e.streamsToShare&&(t=e.streamsToShare);var i=t[n.stream.id];i?(n.stream.isAudio=i.isAudio,n.stream.isVideo=i.isVideo,n.stream.isScreen=i.isScreen):(n.stream.isVideo=!!n.stream.getVideoTracks().length,n.stream.isAudio=!n.stream.isVideo,n.stream.isScreen=!1),n.stream.streamid=n.stream.id,"Firefox"!=DetectRTC.browser.name&&n.stream.stop||(n.stream.stop=function(){var e="ended";"oninactive"in n.stream&&(e="inactive"),o(n.stream,e)}),r[n.stream.id]=n.stream,e.onRemoteStream(n.stream)}},!1),i.onremovestream=function(n){n.stream.streamid=n.stream.id,r[n.stream.id]&&delete r[n.stream.id],e.onRemoteStreamRemoved(n.stream)},this.addRemoteCandidate=function(e){i.addIceCandidate(new S(e))},this.addRemoteSdp=function(e,t){if(t=t||function(){},!window.enableAdapter)return function(e,t){t=t||function(){},"Safari"!==DetectRTC.browser.name&&(e.sdp=n.processSdp(e.sdp)),i.setRemoteDescription(new w(e),t,function(o){n.enableLogs&&console.error("setRemoteDescription failed","\n",o,"\n",e.sdp),t()})}(e,t);"Safari"!==DetectRTC.browser.name&&(e.sdp=n.processSdp(e.sdp)),i.setRemoteDescription(new w(e)).then(t,function(o){n.enableLogs&&console.error("setRemoteDescription failed","\n",o,"\n",e.sdp),t()})};var y=!0;function b(n){n.binaryType="arraybuffer",n.onmessage=function(n){e.onDataChannelMessage(n.data)},n.onopen=function(){e.onDataChannelOpened(n)},n.onerror=function(n){e.onDataChannelError(n)},n.onclose=function(n){e.onDataChannelClosed(n)},n.internalSend=n.send,n.send=function(e){"open"===n.readyState&&n.internalSend(e)},i.channel=n}e.remoteSdp&&(y=!1),this.createDataChannel=function(){b(i.createDataChannel("sctp",{}))},!0!==n.session.data||s||(y?this.createDataChannel():i.ondatachannel=function(e){b(e.channel)}),e.remoteSdp&&(e.remoteSdp.remotePeerSdpConstraints&&(m=e.remoteSdp.remotePeerSdpConstraints),g.sdpConstraints=h(m),this.addRemoteSdp(e.remoteSdp,function(){T("createAnswer")})),"two-way"!=n.session.audio&&"two-way"!=n.session.video&&"two-way"!=n.session.screen||(g.sdpConstraints=h({OfferToReceiveAudio:"two-way"==n.session.audio||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio,OfferToReceiveVideo:"two-way"==n.session.video||"two-way"==n.session.screen||e.remoteSdp&&e.remoteSdp.remotePeerSdpConstraints&&e.remoteSdp.remotePeerSdpConstraints.OfferToReceiveAudio}));var k={};function T(o){if(!window.enableAdapter)return function(o){i[o](function(o){"Safari"!==DetectRTC.browser.name&&(o.sdp=n.processSdp(o.sdp)),i.setLocalDescription(o,function(){n.trickleIce&&(e.onLocalSdp({type:o.type,sdp:o.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:t.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:n?n.extra:{},streamsToShare:k}),n.onSettingLocalDescription(t))},function(e){n.enableLogs&&console.error("setLocalDescription-error",e)})},function(e){n.enableLogs&&console.error("sdp-"+o+"-error",e)},g.sdpConstraints)}(o);i[o](g.sdpConstraints).then(function(o){"Safari"!==DetectRTC.browser.name&&(o.sdp=n.processSdp(o.sdp)),i.setLocalDescription(o).then(function(){n.trickleIce&&(e.onLocalSdp({type:o.type,sdp:o.sdp,remotePeerSdpConstraints:e.remotePeerSdpConstraints||!1,renegotiatingPeer:!!e.renegotiatingPeer||!1,connectionDescription:t.connectionDescription,dontGetRemoteStream:!!e.dontGetRemoteStream,extra:n?n.extra:{},streamsToShare:k}),n.onSettingLocalDescription(t))},function(e){n.enableLogs&&console.error("setLocalDescription error",e)})},function(e){n.enableLogs&&console.error("sdp-error",e)})}u().forEach&&u().forEach(function(e){k[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),y&&T("createOffer"),i.nativeClose=i.close,i.close=function(){if(i){try{-1===i.iceConnectionState.search(/closed|failed/gi)&&i.getRemoteStreams().forEach(function(e){var n="ended";"oninactive"in e&&(n="inactive"),o(e,n)}),i.nativeClose()}catch(e){}i=null,t.peer=null}},this.peer=i}var b=function(){function e(e,o){var i=t(e);return i.videoCodecNumbers?"vp8"===o&&i.vp8LineNumber===i.videoCodecNumbers[0]?e:"vp9"===o&&i.vp9LineNumber===i.videoCodecNumbers[0]?e:"h264"===o&&i.h264LineNumber===i.videoCodecNumbers[0]?e:e=n(e,o,i):e}function n(e,n,t,o){var i="";if("vp8"===n){if(!t.vp8LineNumber)return e;i=t.vp8LineNumber}if("vp9"===n){if(!t.vp9LineNumber)return e;i=t.vp9LineNumber}if("h264"===n){if(!t.h264LineNumber)return e;i=t.h264LineNumber}var r=t.videoCodecNumbersOriginal.split("SAVPF")[0]+"SAVPF ",s=[i];return o&&(s=[]),t.videoCodecNumbers.forEach(function(e){e!==i&&s.push(e)}),r+=s.join(" "),e.replace(t.videoCodecNumbersOriginal,r)}function t(e){var n={};return e.split("\n").forEach(function(e){0===e.indexOf("m=video")&&(n.videoCodecNumbers=[],e.split("SAVPF")[1].split(" ").forEach(function(t){(t=t.trim())&&t.length&&(n.videoCodecNumbers.push(t),n.videoCodecNumbersOriginal=e)})),-1===e.indexOf("VP8/90000")||n.vp8LineNumber||(n.vp8LineNumber=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("VP9/90000")||n.vp9LineNumber||(n.vp9LineNumber=e.replace("a=rtpmap:","").split(" ")[0]),-1===e.indexOf("H264/90000")||n.h264LineNumber||(n.h264LineNumber=e.replace("a=rtpmap:","").split(" ")[0])}),n}function o(e,n,t){return function(e,n,t,o,i){for(var r=e.length,s=0;s<r;++s)if(0===e[s].indexOf(o)&&(!i||-1!==e[s].toLowerCase().indexOf(i.toLowerCase())))return s;return null}(e,0,0,n,t)}function i(e){var n=new RegExp("a=rtpmap:(\\d+) \\w+\\/\\d+"),t=e.match(n);return t&&2===t.length?t[1]:null}return{removeVPX:function(e){var o=t(e);return n(e=n(e,"vp9",o,!0),"vp8",o,!0)},disableNACK:function(e){if(!e||"string"!=typeof e)throw"Invalid arguments.";return(e=(e=(e=e.replace("a=rtcp-fb:126 nack\r\n","")).replace("a=rtcp-fb:126 nack pli\r\n","a=rtcp-fb:126 pli\r\n")).replace("a=rtcp-fb:97 nack\r\n","")).replace("a=rtcp-fb:97 nack pli\r\n","a=rtcp-fb:97 pli\r\n")},prioritize:function(e,n){if(n&&n.getSenders&&n.getSenders().length){if(!e||"string"!=typeof e)throw"Invalid arguments.";n.getSenders().forEach(function(n){for(var t=n.getParameters(),o=0;o<t.codecs.length;o++)if(t.codecs[o].mimeType==e){t.codecs.unshift(t.codecs.splice(o,1));break}n.setParameters(t)})}},removeNonG722:function(e){return e.replace(/m=audio ([0-9]+) RTP\/SAVPF ([0-9 ]*)/g,"m=audio $1 RTP/SAVPF 9")},setApplicationSpecificBandwidth:function(e,n,t){return function(e,n,t){return n?"undefined"!=typeof isFirefox&&isFirefox?e:(t&&(n.screen?n.screen<300&&console.warn("It seems that you are using wrong bandwidth value for screen. Screen sharing is expected to fail."):console.warn("It seems that you are not using bandwidth for screen. Screen sharing is expected to fail.")),n.screen&&t&&(e=(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")).replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+n.screen+"\r\n")),(n.audio||n.video)&&(e=e.replace(/b=AS([^\r\n]+\r\n)/g,"")),n.audio&&(e=e.replace(/a=mid:audio\r\n/g,"a=mid:audio\r\nb=AS:"+n.audio+"\r\n")),n.screen?e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+n.screen+"\r\n"):n.video&&(e=e.replace(/a=mid:video\r\n/g,"a=mid:video\r\nb=AS:"+n.video+"\r\n")),e):e}(e,n,t)},setVideoBitrates:function(e,n){return function(e,n){var t,r=(n=n||{}).min,s=n.max,a=e.split("\r\n"),d=o(a,"a=rtpmap","VP8/90000");if(d&&(t=i(a[d])),!t)return e;var c,u=o(a,"a=rtpmap","rtx/90000");if(u&&(c=i(a[u])),!u)return e;var f=o(a,"a=fmtp:"+c.toString());if(null!==f){var m="\r\n";a[f]=a[f].concat(m+="a=fmtp:"+t+" x-google-min-bitrate="+(r||"228")+"; x-google-max-bitrate="+(s||"228")),e=a.join("\r\n")}return e}(e,n)},setOpusAttributes:function(e,n){return function(e,n){n=n||{};var t,r=e.split("\r\n"),s=o(r,"a=rtpmap","opus/48000");if(s&&(t=i(r[s])),!t)return e;var a=o(r,"a=fmtp:"+t.toString());if(null===a)return e;var d="";return d+="; stereo="+("undefined"!=typeof n.stereo?n.stereo:"1"),d+="; sprop-stereo="+("undefined"!=typeof n["sprop-stereo"]?n["sprop-stereo"]:"1"),"undefined"!=typeof n.maxaveragebitrate&&(d+="; maxaveragebitrate="+(n.maxaveragebitrate||1048576)),"undefined"!=typeof n.maxplaybackrate&&(d+="; maxplaybackrate="+(n.maxplaybackrate||1048576)),"undefined"!=typeof n.cbr&&(d+="; cbr="+("undefined"!=typeof n.cbr?n.cbr:"1")),"undefined"!=typeof n.useinbandfec&&(d+="; useinbandfec="+n.useinbandfec),"undefined"!=typeof n.usedtx&&(d+="; usedtx="+n.usedtx),"undefined"!=typeof n.maxptime&&(d+="\r\na=maxptime:"+n.maxptime),r[a]=r[a].concat(d),r.join("\r\n")}(e,n)},preferVP9:function(n){return e(n,"vp9")},preferCodec:e,forceStereoAudio:function(e){for(var n=e.split("\r\n"),t=null,o=0;o<n.length;o++)if(-1!==n[o].search("opus/48000")){var i=extractSdp(n[o],/:(\d+) opus\/48000/i);break}for(o=0;o<n.length;o++)if(-1!==n[o].search("a=fmtp")&&extractSdp(n[o],/a=fmtp:(\d+)/)===i){t=o;break}return null===t?e:(n[t]=n[t].concat("; stereo=1; sprop-stereo=1"),e=n.join("\r\n"))}}}();window.BandwidthHandler=b;var k=function(e,n){var t=n.candidate,o=e.candidates,i=o.stun,r=o.turn;if(u(o.reflexive)||(i=o.reflexive),u(o.relay)||(r=o.relay),(o.host||!t.match(/typ host/g))&&(r||!t.match(/typ relay/g))&&(i||!t.match(/typ srflx/g))){var s=e.iceProtocols;if((s.udp||!t.match(/ udp /g))&&(s.tcp||!t.match(/ tcp /g)))return e.enableLogs&&console.debug("Your candidate pairs:",t),{candidate:t,sdpMid:n.sdpMid,sdpMLineIndex:n.sdpMLineIndex}}},T=function(e){var n=[{urls:["turn:webrtcweb.com:7788","turn:webrtcweb.com:4455","turn:webrtcweb.com:5544"],username:"muazkh",credential:"muazkh"},{urls:["stun:stun.l.google.com:19302"]}];return"undefined"!=typeof window.InstallTrigger&&(n[0].urls=n[0].urls.pop(),n[1].urls=n[1].urls.pop()),n};function R(e){if(!0!==currentUserMediaRequest.mutex){currentUserMediaRequest.mutex=!0;var n=JSON.stringify(e.localMediaConstraints);if(currentUserMediaRequest.streams[n])s(currentUserMediaRequest.streams[n].stream,!0);else{if(/BB10|BlackBerry/i.test(navigator.userAgent||"")||"undefined"==typeof navigator.mediaDevices||"function"!=typeof navigator.mediaDevices.getUserMedia)return navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,void navigator.getUserMedia(e.localMediaConstraints,function(e){e.streamid=e.streamid||e.id||r(),e.idInstance=n,s(e)},function(n){e.onLocalMediaError(n,e.localMediaConstraints)});if("undefined"==typeof navigator.mediaDevices){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;var t,o,i=function(){};navigator.mediaDevices={getUserMedia:function(e){return navigator.getUserMedia(e,function(e){e(stream),t=stream},function(e){i(e),o=e}),{then:function(e){if(!t)return{then:function(e){o?e(o):i=e}};e(t)}}}}}navigator.mediaDevices.getUserMedia(e.localMediaConstraints).then(function(e){e.streamid=e.streamid||e.id||r(),e.idInstance=n,s(e)}).catch(function(n){e.onLocalMediaError(n,e.localMediaConstraints)})}}else currentUserMediaRequest.queueRequests.push(e);function s(t,o){!function(e,n){e.mandatory&&e.mandatory.chromeMediaSource?n.isScreen=!0:e.mozMediaSource||e.mediaSource?n.isScreen=!0:e.video?n.isVideo=!0:e.audio&&(n.isAudio=!0)}(e.localMediaConstraints,t),e.onGettingLocalMedia(t,o);var i="ended";"oninactive"in t&&(i="inactive"),t.addEventListener(i,function(){delete currentUserMediaRequest.streams[n],currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.indexOf(e)&&(delete currentUserMediaRequest.queueRequests[currentUserMediaRequest.queueRequests.indexOf(e)],currentUserMediaRequest.queueRequests=d(currentUserMediaRequest.queueRequests))},!1),currentUserMediaRequest.streams[n]={stream:t},currentUserMediaRequest.mutex=!1,currentUserMediaRequest.queueRequests.length&&R(currentUserMediaRequest.queueRequests.shift())}}window.currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[],remove:function(e){this.mutex=!1;var n=this.streams[e];if(n){var t=(n=n.stream).currentUserMediaRequestOptions;this.queueRequests.indexOf(t)&&(delete this.queueRequests[this.queueRequests.indexOf(t)],this.queueRequests=d(this.queueRequests)),this.streams[e].stream=null,delete this.streams[e]}}};var x=function(){function e(e){if(e)return"string"==typeof e||"undefined"==typeof e?e:e.audio&&e.video?null:e.audio?"audio":e.video?"video":void 0}return{setHandlers:function(n,t,i){if(n&&n.addEventListener){if("undefined"==typeof t||1==t){var r="ended";"oninactive"in n&&(r="inactive"),n.addEventListener(r,function(){x.onSyncNeeded(this.streamid,r)},!1)}n.mute=function(r,s){r=e(r),"undefined"!=typeof s&&(t=s),"undefined"!=typeof r&&"audio"!=r||n.getAudioTracks().forEach(function(e){e.enabled=!1,i.streamEvents[n.streamid].isAudioMuted=!0}),"undefined"!=typeof r&&"video"!=r||n.getVideoTracks().forEach(function(e){e.enabled=!1}),"undefined"!=typeof t&&1!=t||x.onSyncNeeded(n.streamid,"mute",r),i.streamEvents[n.streamid].muteType=r||"both",o(n,"mute",r)},n.unmute=function(r,s){r=e(r),"undefined"!=typeof s&&(t=s),function(){if(i.streamEvents[n.streamid].mediaElement){var e=i.streamEvents[n.streamid].mediaElement;e.volume=0,function e(n,t,o,i){(i=(i||0)+1)>=t||setTimeout(function(){o(),e(n,t,o,i)},n)}(200,5,function(){try{e.volume+=.2}catch(n){e.volume=1}})}}(),"undefined"!=typeof r&&"audio"!=r||n.getAudioTracks().forEach(function(e){e.enabled=!0,i.streamEvents[n.streamid].isAudioMuted=!1}),"undefined"!=typeof r&&"video"!=r||(n.getVideoTracks().forEach(function(e){e.enabled=!0}),"undefined"!=typeof r&&"video"==r&&i.streamEvents[n.streamid].isAudioMuted&&function e(t){t||(t=0),++t<100&&i.streamEvents[n.streamid].isAudioMuted&&(n.mute("audio"),setTimeout(function(){e(t)},50))}()),"undefined"!=typeof t&&1!=t||x.onSyncNeeded(n.streamid,"unmute",r),i.streamEvents[n.streamid].unmuteType=r||"both",o(n,"unmute",r)}}},onSyncNeeded:function(e,n,t){}}}();window.addEventListener("message",function(e){e.origin==window.location.origin&&function(e){if("PermissionDeniedError"==e){if(O="PermissionDeniedError",E)return E("PermissionDeniedError");throw new Error("PermissionDeniedError: User rejected to share his screen.")}"rtcmulticonnection-extension-loaded"==e&&(O="desktop"),e.sourceId&&E&&E(P=e.sourceId)}(e.data)}),window.IsAndroidChrome=!1;try{navigator.userAgent.toLowerCase().indexOf("android")>-1&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)&&(window.IsAndroidChrome=!0)}catch(e){}var P,E,O="screen";function M(e){if(e)return"Firefox"===DetectRTC.browser.name?D(e):window.IsAndroidChrome?(O="screen",void e(!0)):void("desktop"!=O?(window.postMessage("are-you-there","*"),setTimeout(function(){e("screen"!=O)},2e3)):e(!0))}function D(e){if(e){if("Firefox"!==DetectRTC.browser.name)return M(e);var n=!1;window.addEventListener("message",function t(o){var i=o.data;i&&"undefined"!=typeof i.isScreenCapturingEnabled&&(n=!0,e(!0===i.isScreenCapturingEnabled),window.removeEventListener("message",t,!1))},!1),window.postMessage({checkIfScreenCapturingEnabled:!0,domains:[document.domain]},"*"),setTimeout(function(){n||e(!0)},2e3)}}function A(e,n){if(window.IsAndroidChrome)return O="screen",void n("installed-enabled");if(2!=arguments.length&&(n=e,e=window.RMCExtensionID||"ajhifddimkapgcifgcodmmfdlknahffk"),"Firefox"===DetectRTC.browser.name)return n("not-chrome");var t=document.createElement("img");t.src="chrome-extension://"+e+"/icon.png",t.onload=function(){P=null,O="screen",window.postMessage("are-you-there","*"),setTimeout(function(){n("screen"==O?e==e?"installed-enabled":"installed-disabled":"installed-enabled")},2e3)},t.onerror=function(){n("not-installed")}}function U(e,n){var t=function e(n,t){return 0==t?n:e(t,n%t)}(e,n);return e/t/(n/t)}var L=function(e){var n=e.connection,t=e.channel,o=e.remoteUserId,i=e.text,s=n.chunkSize||1e3,a="",d=!1;"string"!=typeof i&&(d=!0,i=JSON.stringify(i));var c=r(),u=(new Date).getTime();!function e(i,r){var f={type:"text",uuid:c,sendingTime:u};i&&(r=i,f.packets=parseInt(r.length/s)),r.length>s?f.message=r.slice(0,s):(f.message=r,f.last=!0,f.isobject=d),t.send(f,o),(a=r.slice(f.message.length)).length&&setTimeout(function(){e(null,a)},n.chunkInterval||100)}(i)},N={handle:function(e){var n={};e.onFileStart=function(t){var o=document.createElement("div");if(o.title=t.name,o.innerHTML="<label>0%</label> <progress></progress>",t.remoteUserId&&(o.innerHTML+=" (Sharing with:"+t.remoteUserId+")"),e.filesContainer||(e.filesContainer=document.body||document.documentElement),e.filesContainer.insertBefore(o,e.filesContainer.firstChild),!t.remoteUserId)return n[t.uuid]={div:o,progress:o.querySelector("progress"),label:o.querySelector("label")},void(n[t.uuid].progress.max=t.maxChunks);n[t.uuid]||(n[t.uuid]={}),n[t.uuid][t.remoteUserId]={div:o,progress:o.querySelector("progress"),label:o.querySelector("label")},n[t.uuid][t.remoteUserId].progress.max=t.maxChunks},e.onFileProgress=function(e){var t=n[e.uuid];t&&(e.remoteUserId&&!(t=n[e.uuid][e.remoteUserId])||(t.progress.value=e.currentPosition||e.maxChunks||t.progress.max,function(e,n){if(-1!==e.position){var t=+e.position.toFixed(2).split(".")[1]||100;n.innerHTML=t+"%"}}(t.progress,t.label)))},e.onFileEnd=function(e){var t=n[e.uuid];t?e.remoteUserId&&!(t=n[e.uuid][e.remoteUserId])||(t.div.innerHTML=-1!=e.type.indexOf("image")?'<a href="'+e.url+'" download="'+e.name+'">Download <strong style="color:red;">'+e.name+'</strong> </a><br /><img src="'+e.url+'" title="'+e.name+'" style="max-width: 80%;">':'<a href="'+e.url+'" download="'+e.name+'">Download <strong style="color:red;">'+e.name+'</strong> </a><br /><iframe src="'+e.url+'" title="'+e.name+'" style="width: 80%;border: 0;height: inherit;margin-top:1em;"></iframe>'):console.error("No such progress-helper element exist.",e)}}},I={handle:function(e){e.autoTranslateText=!1,e.language="en",e.googKey="AIzaSyCgB5hmFY74WYB-EoWkhr9cAGr6TiTHrEE",e.Translator={TranslateText:function(n,t){var o=document.createElement("script");o.type="text/javascript";var i=encodeURIComponent(n),r="method"+e.token();window[r]=function(e){e.data&&e.data.translations[0]&&t?t(e.data.translations[0].translatedText):e.error&&"Daily Limit Exceeded"===e.error.message?console.error('Text translation failed. Error message: "Daily Limit Exceeded."'):e.error?console.error(e.error.message):console.error(e)},o.src="https://www.googleapis.com/language/translate/v2?key="+e.googKey+"&target="+(e.language||"en-US")+"&callback=window."+r+"&q="+i,document.getElementsByTagName("head")[0].appendChild(o)},getListOfLanguages:function(n){var t=new XMLHttpRequest;t.onreadystatechange=function(){if(t.readyState==XMLHttpRequest.DONE){var e=JSON.parse(t.responseText);if(e&&e.data&&e.data.languages)return void n(e.data.languages);if(e.error&&"Daily Limit Exceeded"===e.error.message)return void console.error('Text translation failed. Error message: "Daily Limit Exceeded."');if(e.error)return void console.error(e.error.message);console.error(e)}},t.open("GET","https://www.googleapis.com/language/translate/v2/languages?key="+e.googKey+"&target=en",!0),t.send(null)}}}};!function(o){n=n||{useDefaultDevices:!0},o.channel=o.sessionid=(e||location.href.replace(/\/|:|#|\?|\$|\^|%|\.|`|~|!|\+|@|\[|\||]|\|*. /g,"").split("\n").join("").split("\r").join(""))+"";var d=new function(e){var n=this,t=["getAllParticipants","getLength","selectFirst","streams","send","forEach"];function o(){e.fbr=new FileBufferReader,e.fbr.onProgress=function(n){e.onFileProgress(n)},e.fbr.onBegin=function(n){e.onFileStart(n)},e.fbr.onEnd=function(n){e.onFileEnd(n)}}e.peersBackup={},e.peers={getLength:function(){var e=0;for(var n in this)-1==t.indexOf(n)&&e++;return e},selectFirst:function(){var e;for(var n in this)-1==t.indexOf(n)&&(e=this[n]);return e},getAllParticipants:function(e){var n=[];for(var o in this)-1==t.indexOf(o)&&o!=e&&n.push(o);return n},forEach:function(n){this.getAllParticipants().forEach(function(t){n(e.peers[t])})},send:function(t,o){var i=this;if(u(t.size)||u(t.type))if("text"===t.type||t instanceof ArrayBuffer||t instanceof DataView){if("text"===t.type&&(t=JSON.stringify(t)),o){var r=e.peers[o];if(r)return r.channels.length?void r.channels.forEach(function(e){e.send(t)}):(e.peers[o].createDataChannel(),e.renegotiate(o),void setTimeout(function(){i.send(t,o)},3e3))}this.getAllParticipants().forEach(function(n){if(!i[n].channels.length)return e.peers[n].createDataChannel(),e.renegotiate(n),void setTimeout(function(){i[n].channels.forEach(function(e){e.send(t)})},3e3);i[n].channels.forEach(function(e){e.send(t)})})}else L({text:t,channel:this,connection:e,remoteUserId:o});else n.shareFile(t,o)}},this.uuid=e.userid,this.getLocalConfig=function(t,i,r){return r||(r={}),{streamsToShare:r.streamsToShare||{},rtcMultiConnection:e,connectionDescription:r.connectionDescription,userid:i,localPeerSdpConstraints:r.localPeerSdpConstraints,remotePeerSdpConstraints:r.remotePeerSdpConstraints,dontGetRemoteStream:!!r.dontGetRemoteStream,dontAttachLocalStream:!!r.dontAttachLocalStream,renegotiatingPeer:!!r.renegotiatingPeer,peerRef:r.peerRef,channels:r.channels||[],onLocalSdp:function(e){n.onNegotiationNeeded(e,i)},onLocalCandidate:function(t){(t=k(e,t))&&n.onNegotiationNeeded(t,i)},remoteSdp:t,onDataChannelMessage:function(t){if(!e.fbr&&e.enableFileSharing&&o(),"string"!=typeof t&&e.enableFileSharing){var r=this;t instanceof ArrayBuffer||t instanceof DataView?e.fbr.convertToObject(t,function(e){r.onDataChannelMessage(e)}):t.readyForNextChunk?e.fbr.getNextChunk(t,function(n,t){e.peers[i].channels.forEach(function(e){e.send(n)})},i):t.chunkMissing?e.fbr.chunkMissing(t):e.fbr.addChunk(t,function(n){e.peers[i].peer.channel.send(n)})}else n.onDataChannelMessage(t,i)},onDataChannelError:function(e){n.onDataChannelError(e,i)},onDataChannelOpened:function(e){n.onDataChannelOpened(e,i)},onDataChannelClosed:function(e){n.onDataChannelClosed(e,i)},onRemoteStream:function(t){e.peers[i]&&e.peers[i].streams.push(t),n.onGettingRemoteMedia(t,i)},onRemoteStreamRemoved:function(e){n.onRemovingRemoteMedia(e,i)},onPeerStateChanged:function(e){n.onPeerStateChanged(e),"new"===e.iceConnectionState&&n.onNegotiationStarted(i,e),"connected"===e.iceConnectionState&&n.onNegotiationCompleted(i,e),-1!==e.iceConnectionState.search(/closed|failed/gi)&&(n.onUserLeft(i),n.disconnectWith(i))}}},this.createNewPeer=function(n,t){if(!(e.maxParticipantsAllowed<=e.getAllParticipants().length)){if(t=t||{},e.isInitiator&&e.session.audio&&"two-way"===e.session.audio&&!t.streamsToShare&&(t.isOneWay=!1,t.isDataOnly=!1,t.session=e.session),!t.isOneWay&&!t.isDataOnly)return t.isOneWay=!0,void this.onNegotiationNeeded({enableMedia:!0,userPreferences:t},n);t=e.setUserPreferences(t,n);var o=this.getLocalConfig(null,n,t);e.peers[n]=new y(o)}},this.createAnsweringPeer=function(n,t,o){o=e.setUserPreferences(o||{},t);var i=this.getLocalConfig(n,t,o);e.peers[t]=new y(i)},this.renegotiatePeer=function(n,t,o){if(e.peers[n]){t||(t={}),t.renegotiatingPeer=!0,t.peerRef=e.peers[n].peer,t.channels=e.peers[n].channels;var i=this.getLocalConfig(o,n,t);e.peers[n]=new y(i)}else e.enableLogs&&console.error("Peer ("+n+") does not exist. Renegotiation skipped.")},this.replaceTrack=function(n,t,o){if(!e.peers[t])throw"This peer ("+t+") does not exist.";var i=e.peers[t].peer;i.getSenders&&"function"==typeof i.getSenders&&i.getSenders().length?i.getSenders().forEach(function(i){o&&i.track instanceof VideoStreamTrack&&(e.peers[t].peer.lastVideoTrack=i.track,i.replaceTrack(n)),!o&&i.track instanceof AudioStreamTrack&&(e.peers[t].peer.lastAudioTrack=i.track,i.replaceTrack(n))}):(console.warn("RTPSender.replaceTrack is NOT supported."),this.renegotiatePeer(t))},this.onNegotiationNeeded=function(e,n){},this.addNegotiatedMessage=function(t,o){if(t.type&&t.sdp)return"answer"==t.type&&e.peers[o]&&e.peers[o].addRemoteSdp(t),"offer"==t.type&&(t.renegotiatingPeer?this.renegotiatePeer(o,null,t):this.createAnsweringPeer(t,o)),void(e.enableLogs&&console.log("Remote peer's sdp:",t.sdp));if(t.candidate)return e.peers[o]&&e.peers[o].addRemoteCandidate(t),void(e.enableLogs&&console.log("Remote peer's candidate pairs:",t.candidate));if(t.enableMedia){e.session=t.userPreferences.session||e.session,e.session.oneway&&e.attachStreams.length&&(e.attachStreams=[]),t.userPreferences.isDataOnly&&e.attachStreams.length&&(e.attachStreams.length=[]);var i={};e.attachStreams.forEach(function(e){i[e.streamid]={isAudio:!!e.isAudio,isVideo:!!e.isVideo,isScreen:!!e.isScreen}}),t.userPreferences.streamsToShare=i,n.onNegotiationNeeded({readyForOffer:!0,userPreferences:t.userPreferences},o)}t.readyForOffer&&e.onReadyForOffer(o,t.userPreferences)},this.connectNewParticipantWithAllBroadcasters=function(t,o,i){if(!e.socket.isIO&&(i=(i||"").split("|-,-|")).length){var r,s=[];i.forEach(function(e){(e=(e||"").replace(/ /g,"")).length&&(r?s.push(e):r=e)}),r&&(n.onNegotiationNeeded({newParticipant:t,userPreferences:o||!1},r),s.length&&setTimeout(function(){n.connectNewParticipantWithAllBroadcasters(t,o,s.join("|-,-|"))},3e3))}},this.onGettingRemoteMedia=function(e,n){},this.onRemovingRemoteMedia=function(e,n){},this.onGettingLocalMedia=function(e){},this.onLocalMediaError=function(n,t){e.onMediaError(n,t)},this.shareFile=function(n,t){if(!e.enableFileSharing)throw'"connection.enableFileSharing" is false.';o(),e.fbr.readAsArrayBuffer(n,function(n){var o=e.getAllParticipants();t&&(o=[t]),o.forEach(function(t){e.fbr.getNextChunk(n,function(n){e.peers[t].channels.forEach(function(e){e.send(n)})},t)})},{userid:e.userid,chunkSize:"Firefox"===DetectRTC.browser.name?15e3:e.chunkSize||0})};var i=new function(e){var n={};return{receive:function(t,o,i){var r=t.uuid;if(n[r]||(n[r]=[]),n[r].push(t.message),t.last){var s=n[r].join("");t.isobject&&(s=JSON.parse(s));var a={data:s,userid:o,extra:i,latency:(new Date).getTime()-t.sendingTime};e.autoTranslateText?(a.original=a.data,e.Translator.TranslateText(a.data,function(n){a.data=n,e.onmessage(a)})):e.onmessage(a),delete n[r]}}}}(e);this.onDataChannelMessage=function(n,t){i.receive(JSON.parse(n),t,e.peers[t]?e.peers[t].extra:{})},this.onDataChannelClosed=function(n,t){n.userid=t,n.extra=e.peers[t]?e.peers[t].extra:{},e.onclose(n)},this.onDataChannelError=function(n,t){n.userid=t,event.extra=e.peers[t]?e.peers[t].extra:{},e.onerror(n)},this.onDataChannelOpened=function(n,t){e.peers[t].channels.length?e.peers[t].channels=[n]:(e.peers[t].channels.push(n),e.onopen({userid:t,extra:e.peers[t]?e.peers[t].extra:{},channel:n}))},this.onPeerStateChanged=function(n){e.onPeerStateChanged(n)},this.onNegotiationStarted=function(e,n){},this.onNegotiationCompleted=function(e,n){},this.getRemoteStreams=function(n){return n=n||e.peers.getAllParticipants()[0],e.peers[n]?e.peers[n].streams:[]}}(o),p={};function g(e){if(o.socketAutoReConnect=!0,o.socket)e&&e(o.socket);else{if("undefined"==typeof t)if("undefined"!=typeof FirebaseConnection)window.SocketConnection=FirebaseConnection;else{if("undefined"==typeof PubNubConnection)throw"SocketConnection.js seems missed.";window.SocketConnection=PubNubConnection}new t(o,function(n){e&&e(o.socket)})}}function h(e,n){if(o.dontCaptureUserMedia||e.isDataOnly)n();else{var t={};e.localPeerSdpConstraints.OfferToReceiveAudio&&(t.audio=o.mediaConstraints.audio),e.localPeerSdpConstraints.OfferToReceiveVideo&&(t.video=o.mediaConstraints.video);var i=e.session||o.session;i.oneway&&"two-way"!==i.audio&&"two-way"!==i.video&&"two-way"!==i.screen?n():(i.oneway&&i.audio&&"two-way"===i.audio&&(i={audio:!0}),(i.audio||i.video||i.screen)&&(i.screen?o.getScreenConstraints(function(e,t){o.invokeGetUserMedia({audio:!!m(o)&&l(t),video:t,isScreen:!0},!i.audio&&!i.video||m(o)?n:o.invokeGetUserMedia(null,n))}):(i.audio||i.video)&&o.invokeGetUserMedia(null,n,i)))}}function w(e,n){o.closeBeforeUnload&&(!0===o.isInitiator&&o.dontMakeMeModerator(),o.peers.getAllParticipants().forEach(function(e){d.onNegotiationNeeded({userLeft:!0},e),o.peers[e]&&o.peers[e].peer&&o.peers[e].peer.close(),delete o.peers[e]}),n||o.closeSocket(),o.broadcasters=[],o.isInitiator=!1)}function S(e,n){e?(n.audio&&e.getAudioTracks().forEach(function(e){e.applyConstraints(n.audio)}),n.video&&e.getVideoTracks().forEach(function(e){e.applyConstraints(n.video)})):o.enableLogs&&console.error("No stream to applyConstraints.")}function W(e,n,t){n?d.replaceTrack(e,n,t):o.peers.getAllParticipants().forEach(function(n){d.replaceTrack(e,n,t)})}function B(){if(o.isInitiator&&!o.session.oneway&&!o.session.broadcast&&"many-to-many"===o.direction){var e=o.broadcasters[0],n=[];o.broadcasters.forEach(function(t){t!==e&&n.push(t)}),o.autoCloseEntireSession||o.shiftModerationControl(e,n,!0)}}d.onGettingLocalMedia=function(e){if(!p[e.streamid]){p[e.streamid]=!0;try{e.type="local"}catch(e){}o.setStreamEndHandler(e),s(e,function(n){n.id=e.streamid,n.muted=!0,n.volume=0,-1===o.attachStreams.indexOf(e)&&o.attachStreams.push(e),"undefined"!=typeof x&&x.setHandlers(e,!0,o),o.streamEvents[e.streamid]={stream:e,type:"local",mediaElement:n,userid:o.userid,extra:o.extra,streamid:e.streamid,isAudioMuted:!0},function(e,n){if(!e||!n)throw"Both arguments are required.";if(e.onspeaking&&e.onsilence){if("undefined"==typeof hark)throw"hark.js not found.";hark(n.stream,{onspeaking:function(){e.onspeaking(n)},onsilence:function(){e.onsilence(n)},onvolumechange:function(t,o){e.onvolumechange&&e.onvolumechange(merge({volume:t,threshold:o},n))}})}}(o,o.streamEvents[e.streamid]),i(o,o.streamEvents[e.streamid]),o.onstream(o.streamEvents[e.streamid])},o)}},d.onGettingRemoteMedia=function(e,n){try{e.type="remote"}catch(e){}o.setStreamEndHandler(e,"remote-stream"),s(e,function(t){t.id=e.streamid,"undefined"!=typeof x&&x.setHandlers(e,!1,o),o.streamEvents[e.streamid]={stream:e,type:"remote",userid:n,extra:o.peers[n]?o.peers[n].extra:{},mediaElement:t,streamid:e.streamid},i(o,o.streamEvents[e.streamid]),o.onstream(o.streamEvents[e.streamid])},o)},d.onRemovingRemoteMedia=function(e,n){var t=o.streamEvents[e.streamid];t||(t={stream:e,type:"remote",userid:n,extra:o.peers[n]?o.peers[n].extra:{},streamid:e.streamid,mediaElement:o.streamEvents[e.streamid]?o.streamEvents[e.streamid].mediaElement:null}),o.peersBackup[t.userid]&&(t.extra=o.peersBackup[t.userid].extra),o.onstreamended(t),delete o.streamEvents[e.streamid]},d.onNegotiationNeeded=function(e,n,t){n=n||e.remoteUserId,g(function(){o.socket.emit(o.socketMessageEvent,"password"in e?e:{remoteUserId:n,message:e,sender:o.userid},t||function(){})})},d.onUserLeft=function(e){o.deletePeer(e)},d.disconnectWith=function(e,n){o.socket&&o.socket.emit("disconnect-with",e,n||function(){}),o.deletePeer(e)},o.broadcasters=[],o.socketOptions={transport:"polling"},o.openOrJoin=function(e,n){o.checkPresence(e,function(t,i){if("function"==typeof n&&(n(t,i),n=null),t){o.sessionid=i;var r=!!o.session.oneway,s=c(o.session),a={remoteUserId:o.sessionid,message:{newParticipationRequest:!0,isOneWay:r,isDataOnly:s,localPeerSdpConstraints:{OfferToReceiveAudio:r?!!o.session.audio:o.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:r?!!o.session.video||!!o.session.screen:o.sdpConstraints.mandatory.OfferToReceiveVideo},remotePeerSdpConstraints:{OfferToReceiveAudio:o.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:o.sdpConstraints.mandatory.OfferToReceiveVideo}},sender:o.userid,password:n||!1};h(a.message,function(){d.onNegotiationNeeded(a)})}else o.userid=o.sessionid=e||o.sessionid,o.userid+="",o.socket.emit("changed-uuid",o.userid),n&&o.socket.emit("set-password",n),o.isInitiator=!0,c(o.session)||o.captureUserMedia()})},o.open=function(e,n){o.userid=o.sessionid=e||o.sessionid,o.userid+="",o.isInitiator=!0,g(function(){o.socket.emit("changed-uuid",o.userid),1==n&&o.becomePublicModerator(),c(o.session)?"function"==typeof n&&n():o.captureUserMedia("function"==typeof n?n:null)})},o.becomePublicModerator=function(){o.isInitiator&&o.socket.emit("become-a-public-moderator")},o.dontMakeMeModerator=function(){o.socket.emit("dont-make-me-moderator")},o.deletePeer=function(e){if(e){var n={userid:e,extra:o.peers[e]?o.peers[e].extra:{}};if(o.peersBackup[n.userid]&&(n.extra=o.peersBackup[n.userid].extra),o.onleave(n),o.peers[e]){o.peers[e].streams.forEach(function(e){e.stop()});var t=o.peers[e].peer;if(t&&"closed"!==t.iceConnectionState)try{t.close()}catch(e){}o.peers[e]&&(o.peers[e].peer=null,delete o.peers[e])}if(-1!==o.broadcasters.indexOf(e)){var i=[];o.broadcasters.forEach(function(n){n!==e&&i.push(n)}),o.broadcasters=i,B()}}},o.rejoin=function(e){if(!o.isInitiator&&e&&Object.keys(e).length){var n={};o.peers[e.remoteUserId]&&(n=o.peers[e.remoteUserId].extra,o.deletePeer(e.remoteUserId)),e&&e.remoteUserId&&(o.join(e.remoteUserId),o.onReConnecting({userid:e.remoteUserId,extra:n}))}},o.join=o.connect=function(e,n){o.sessionid=!!e&&(e.sessionid||e.remoteUserId||e)||o.sessionid,o.sessionid+="";var t=!1,i=!1,r=!1,s=!1;if(e&&e.session||!e||"string"==typeof e){var a=e&&e.session||o.session;r=!!a.oneway,s=c(a),i={OfferToReceiveAudio:o.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:o.sdpConstraints.mandatory.OfferToReceiveVideo},t={OfferToReceiveAudio:r?!!o.session.audio:o.sdpConstraints.mandatory.OfferToReceiveAudio,OfferToReceiveVideo:r?!!o.session.video||!!o.session.screen:o.sdpConstraints.mandatory.OfferToReceiveVideo}}var u=function(){};"function"==typeof(n=n||{})&&(u=n,n={}),"undefined"!=typeof n.localPeerSdpConstraints&&(t=n.localPeerSdpConstraints),"undefined"!=typeof n.remotePeerSdpConstraints&&(i=n.remotePeerSdpConstraints),"undefined"!=typeof n.isOneWay&&(r=n.isOneWay),"undefined"!=typeof n.isDataOnly&&(s=n.isDataOnly);var f={remoteUserId:o.sessionid,message:{newParticipationRequest:!0,isOneWay:r,isDataOnly:s,localPeerSdpConstraints:t,remotePeerSdpConstraints:i},sender:o.userid,password:!1};return h(f.message,function(){g(function(){o.peers[o.sessionid]||(d.onNegotiationNeeded(f),u())})}),f},o.connectWithAllParticipants=function(e){d.onNegotiationNeeded("connectWithAllParticipants",e||o.sessionid)},o.removeFromBroadcastersList=function(e){d.onNegotiationNeeded("removeFromBroadcastersList",e||o.sessionid),o.peers.getAllParticipants(e||o.sessionid).forEach(function(e){d.onNegotiationNeeded("dropPeerConnection",e),o.deletePeer(e)}),o.attachStreams.forEach(function(e){e.stop()})},o.getUserMedia=o.captureUserMedia=function(e,n){e=e||function(){};var t=n||o.session;o.dontCaptureUserMedia||c(t)?e():(t.audio||t.video||t.screen)&&(t.screen?o.getScreenConstraints(function(i,r){if(i)throw i;o.invokeGetUserMedia({audio:!!m(o)&&l(r),video:r,isScreen:!0},function(i){if(!t.audio&&!t.video||m(o))e(i);else{var r={};for(var s in t)"screen"!==s&&(r[s]=t[s]);o.invokeGetUserMedia(n,e,r)}})}):(t.audio||t.video)&&o.invokeGetUserMedia(n,e,t))},o.closeBeforeUnload=!0,window.addEventListener("beforeunload",w,!1),o.userid=r(),o.changeUserId=function(e,n){n=n||function(){},o.userid=e||r(),o.socket.emit("changed-uuid",o.userid,n)},o.extra={},o.attachStreams=[],o.session={audio:!0,video:!0},o.enableFileSharing=!1,o.bandwidth={screen:!1,audio:!1,video:!1},o.codecs={audio:"opus",video:"VP9"},o.processSdp=function(e){return"Safari"===DetectRTC.browser.name?e:("VP8"===o.codecs.video.toUpperCase()&&(e=b.preferCodec(e,"vp8")),"VP9"===o.codecs.video.toUpperCase()&&(e=b.preferCodec(e,"vp9")),"H264"===o.codecs.video.toUpperCase()&&(e=b.preferCodec(e,"h264")),"G722"===o.codecs.audio&&(e=b.removeNonG722(e)),"Firefox"===DetectRTC.browser.name?e:((o.bandwidth.video||o.bandwidth.screen)&&(e=b.setApplicationSpecificBandwidth(e,o.bandwidth,!!o.session.screen)),o.bandwidth.video&&(e=b.setVideoBitrates(e,{min:8*o.bandwidth.video*1024,max:8*o.bandwidth.video*1024})),o.bandwidth.audio&&(e=b.setOpusAttributes(e,{maxaveragebitrate:8*o.bandwidth.audio*1024,maxplaybackrate:8*o.bandwidth.audio*1024,stereo:1,maxptime:3})),e))},"undefined"!=typeof b&&(o.BandwidthHandler=o.CodecsHandler=b),o.mediaConstraints={audio:{mandatory:{},optional:o.bandwidth.audio?[{bandwidth:8*o.bandwidth.audio*1024||1048576}]:[]},video:{mandatory:{},optional:o.bandwidth.video?[{bandwidth:8*o.bandwidth.video*1024||1048576},{facingMode:"user"}]:[{facingMode:"user"}]}},"Firefox"===DetectRTC.browser.name&&(o.mediaConstraints={audio:!0,video:!0}),n.useDefaultDevices||DetectRTC.isMobileDevice||DetectRTC.load(function(){var e,n;if(DetectRTC.MediaDevices.forEach(function(t){"audioinput"===t.kind&&!1!==o.mediaConstraints.audio&&(e=t),"videoinput"===t.kind&&!1!==o.mediaConstraints.video&&(n=t)}),e){if("Firefox"===DetectRTC.browser.name)return void(!0!==o.mediaConstraints.audio?o.mediaConstraints.audio.deviceId=e.id:o.mediaConstraints.audio={deviceId:e.id});1==o.mediaConstraints.audio&&(o.mediaConstraints.audio={mandatory:{},optional:[]}),o.mediaConstraints.audio.optional||(o.mediaConstraints.audio.optional=[]),o.mediaConstraints.audio.optional=[{sourceId:e.id}].concat(o.mediaConstraints.audio.optional)}if(n){if("Firefox"===DetectRTC.browser.name)return void(!0!==o.mediaConstraints.video?o.mediaConstraints.video.deviceId=n.id:o.mediaConstraints.video={deviceId:n.id});1==o.mediaConstraints.video&&(o.mediaConstraints.video={mandatory:{},optional:[]}),o.mediaConstraints.video.optional||(o.mediaConstraints.video.optional=[]),o.mediaConstraints.video.optional=[{sourceId:n.id}].concat(o.mediaConstraints.video.optional)}}),o.sdpConstraints={mandatory:{OfferToReceiveAudio:!0,OfferToReceiveVideo:!0},optional:[{VoiceActivityDetection:!1}]},o.rtcpMuxPolicy="require",o.iceTransportPolicy=null,o.optionalArgument={optional:[{DtlsSrtpKeyAgreement:!0},{googImprovedWifiBwe:!0},{googScreencastMinBitrate:300},{googIPv6:!0},{googDscp:!0},{googCpuUnderuseThreshold:55},{googCpuOveruseThreshold:85},{googSuspendBelowMinBitrate:!0},{googCpuOveruseDetection:!0}],mandatory:{}},o.iceServers=T(o),o.candidates={host:!0,stun:!0,turn:!0},o.iceProtocols={tcp:!0,udp:!0},o.onopen=function(e){o.enableLogs&&console.info("Data connection has been opened between you & ",e.userid)},o.onclose=function(e){o.enableLogs&&console.warn("Data connection has been closed between you & ",e.userid)},o.onerror=function(e){o.enableLogs&&console.error(e.userid,"data-error",e)},o.onmessage=function(e){o.enableLogs&&console.debug("data-message",e.userid,e.data)},o.send=function(e,n){o.peers.send(e,n)},o.close=o.disconnect=o.leave=function(){w(0,!0)},o.closeEntireSession=function(e){e=e||function(){},o.socket.emit("close-entire-session",function n(){o.getAllParticipants().length?setTimeout(n,100):(o.onEntireSessionClosed({sessionid:o.sessionid,userid:o.userid,extra:o.extra}),o.changeUserId(null,function(){o.close(),e()}))})},o.onEntireSessionClosed=function(e){o.enableLogs&&console.info("Entire session is closed: ",e.sessionid,e.extra)},o.onstream=function(e){var n=o.videosContainer;n.insertBefore(e.mediaElement,n.firstChild);var t=e.mediaElement.play();"undefined"==typeof t?setTimeout(function(){e.mediaElement.play()},2e3):t.catch(function(){}).then(function(){setTimeout(function(){e.mediaElement.play()},2e3)})},o.onstreamended=function(e){e.mediaElement||(e.mediaElement=document.getElementById(e.streamid)),e.mediaElement&&e.mediaElement.parentNode&&e.mediaElement.parentNode.removeChild(e.mediaElement)},o.direction="many-to-many",o.removeStream=function(e,n){var t;o.attachStreams.forEach(function(n){n.id===e&&(t=n)}),t?(o.peers.getAllParticipants().forEach(function(e){if(!n||e===n){var i=o.peers[e];try{i.peer.removeStream(t)}catch(e){}}}),o.renegotiate()):console.warn("No such stream exist.",e)},o.addStream=function(e,n){if(e.getAudioTracks)return-1===o.attachStreams.indexOf(e)&&(e.streamid||(e.streamid=e.id),o.attachStreams.push(e)),void o.renegotiate(n);function t(t){e.streamCallback&&e.streamCallback(t),o.renegotiate(n)}c(e)?o.renegotiate(n):(e.audio||e.video||e.screen)&&(e.screen?o.getScreenConstraints(function(n,i){if(n)return"PermissionDeniedError"===n?(e.streamCallback&&e.streamCallback(null),void(o.enableLogs&&console.error("User rejected to share his screen."))):alert(n);o.invokeGetUserMedia({audio:!!m(o)&&l(i),video:i,isScreen:!0},!e.audio&&!e.video||m(o)?t:o.invokeGetUserMedia(null,t))}):(e.audio||e.video)&&o.invokeGetUserMedia(null,t))},o.invokeGetUserMedia=function(e,n,t){t||(t=o.session),e||(e=o.mediaConstraints),R({onGettingLocalMedia:function(t){var o=e.video;o&&(o.mediaSource||o.mozMediaSource?t.isScreen=!0:o.mandatory&&o.mandatory.chromeMediaSource&&(t.isScreen=!0)),t.isScreen||(t.isVideo=t.getVideoTracks().length,t.isAudio=!t.isVideo&&t.getAudioTracks().length),d.onGettingLocalMedia(t),n&&n(t)},onLocalMediaError:function(e,n){d.onLocalMediaError(e,n)},localMediaConstraints:e||{audio:!!t.audio&&e.audio,video:!!t.video&&e.video}})},o.applyConstraints=function(e,n){if(C&&C.prototype.applyConstraints){var t;if(n)return o.streamEvents[n]&&(t=o.streamEvents[n].stream),void S(t,e);o.attachStreams.forEach(function(n){S(n,e)})}else alert("track.applyConstraints is NOT supported in your browser.")},o.replaceTrack=function(e,n,t){if(e=e||{},v.prototype.getSenders)if(e instanceof C)W(e,n,t);else{if(e instanceof f)return e.getVideoTracks().length&&W(e.getVideoTracks()[0],n,!0),void(e.getAudioTracks().length&&W(e.getAudioTracks()[0],n,!1));if(c(e))throw"connection.replaceTrack requires audio and/or video and/or screen.";(e.audio||e.video||e.screen)&&(e.screen?o.getScreenConstraints(function(n,t){if(n)return alert(n);o.invokeGetUserMedia({audio:!!m(o)&&l(t),video:t,isScreen:!0},!e.audio&&!e.video||m(o)?i:o.invokeGetUserMedia(null,i))}):(e.audio||e.video)&&o.invokeGetUserMedia(null,i))}else o.addStream(e);function i(i){o.replaceTrack(i,n,t||e.video||e.screen)}},o.resetTrack=function(e,n){e||(e=o.getAllParticipants()),"string"==typeof e&&(e=[e]),e.forEach(function(e){var t=o.peers[e].peer;"undefined"!=typeof n&&!0!==n||!t.lastVideoTrack||o.replaceTrack(t.lastVideoTrack,e,!0),"undefined"!=typeof n&&!1!==n||!t.lastAudioTrack||o.replaceTrack(t.lastAudioTrack,e,!1)})},o.renegotiate=function(e){e?d.renegotiatePeer(e):o.peers.getAllParticipants().forEach(function(e){d.renegotiatePeer(e)})},o.setStreamEndHandler=function(e,n){if(e&&e.addEventListener&&(n=!!n,!e.alreadySetEndHandler)){e.alreadySetEndHandler=!0;var t="ended";"oninactive"in e&&(t="inactive"),e.addEventListener(t,function(){if(e.idInstance&&currentUserMediaRequest.remove(e.idInstance),!n){var t=[];o.attachStreams.forEach(function(n){n.id!=e.id&&t.push(n)}),o.attachStreams=t}var i=o.streamEvents[e.streamid];i||(i={stream:e,streamid:e.streamid,type:n?"remote":"local",userid:o.userid,extra:o.extra,mediaElement:o.streamEvents[e.streamid]?o.streamEvents[e.streamid].mediaElement:null}),n&&o.peers[i.userid]&&(t=[],o.peers[i.userid].peer.getRemoteStreams().forEach(function(n){n.id!=e.id&&t.push(n)}),o.peers[i.userid].streams=t),i.userid===o.userid&&"remote"===i.type||(o.peersBackup[i.userid]&&(i.extra=o.peersBackup[i.userid].extra),o.onstreamended(i),delete o.streamEvents[e.streamid])},!1)}},o.onMediaError=function(e,n){o.enableLogs&&console.error(e,n)},o.addNewBroadcaster=function(e,n){o.socket.isIO||(o.broadcasters.length&&setTimeout(function(){d.connectNewParticipantWithAllBroadcasters(e,n,o.broadcasters.join("|-,-|"))},1e4),o.session.oneway||o.session.broadcast||"many-to-many"!==o.direction||-1!==o.broadcasters.indexOf(e)||(o.broadcasters.push(e),B()))},o.autoCloseEntireSession=!1,o.filesContainer=o.videosContainer=document.body||document.documentElement,o.isInitiator=!1,o.shareFile=d.shareFile,"undefined"!=typeof N&&N.handle(o),"undefined"!=typeof I&&I.handle(o),o.token=r,o.onNewParticipant=function(e,n){o.acceptParticipationRequest(e,n)},o.acceptParticipationRequest=function(e,n){n.successCallback&&(n.successCallback(),delete n.successCallback),d.createNewPeer(e,n)},o.onShiftedModerationControl=function(e,n){o.acceptModerationControl(e,n)},o.acceptModerationControl=function(e,n){o.isInitiator=!0,o.broadcasters=n,o.peers.getAllParticipants().forEach(function(n){d.onNegotiationNeeded({changedUUID:e,oldUUID:o.userid,newUUID:e},n)}),o.userid=e,o.changeUserId(o.userid)},o.shiftModerationControl=function(e,n,t){d.onNegotiationNeeded({shiftedModerationControl:!0,broadcasters:n,firedOnLeave:!!t},e)},"undefined"!=typeof x&&(o.StreamsHandler=x),o.onleave=function(e){},o.invokeSelectFileDialog=function(e){var n=new FileSelector;n.accept="*.*",n.selectSingleFile(e)},o.getPublicModerators=o.getPublicUsers=function(e,n){"function"==typeof e&&(n=e),g(function(){o.socket.emit("get-public-moderators","string"==typeof e?e:"",n)})},o.onmute=function(e){if(e&&e.mediaElement)if("both"===e.muteType||"video"===e.muteType){e.mediaElement.src=null;var n=e.mediaElement.pause();"undefined"!=typeof n?n.then(function(){e.mediaElement.poster=e.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"}):e.mediaElement.poster=e.snapshot||"https://cdn.webrtc-experiment.com/images/muted.png"}else"audio"===e.muteType&&(e.mediaElement.muted=!0)},o.onunmute=function(e){e&&e.mediaElement&&e.stream&&("both"===e.unmuteType||"video"===e.unmuteType?(e.mediaElement.poster=null,e.mediaElement.srcObject=e.stream,e.mediaElement.play()):"audio"===e.unmuteType&&(e.mediaElement.muted=!1))},o.onExtraDataUpdated=function(e){e.status="online",o.onUserStatusChanged(e,!0)},o.onJoinWithPassword=function(e){console.warn(e,"is password protected. Please join with password.")},o.onInvalidPassword=function(e,n){console.warn(e,"is password protected. Please join with valid password. Your old password",n,"is wrong.")},o.onPasswordMaxTriesOver=function(e){console.warn(e,"is password protected. Your max password tries exceeded the limit.")},o.getAllParticipants=function(e){return o.peers.getAllParticipants(e)},"undefined"!=typeof x&&(x.onSyncNeeded=function(e,n,t){o.peers.getAllParticipants().forEach(function(o){d.onNegotiationNeeded({streamid:e,action:n,streamSyncNeeded:!0,type:t||"both"},o)})}),o.connectSocket=function(e){g(e)},o.closeSocket=function(){try{io.sockets={}}catch(e){}o.socket&&("function"==typeof o.socket.disconnect&&o.socket.disconnect(),"function"==typeof o.socket.resetProps&&o.socket.resetProps(),o.socket=null)},o.getSocket=function(e){return o.socket?e&&e(o.socket):g(e),o.socket},o.getRemoteStreams=d.getRemoteStreams;var V=["selectFirst","selectAll","forEach"];if(o.streamEvents={selectFirst:function(e){if(!e){var n;for(var t in o.streamEvents)-1!==V.indexOf(t)||n||(n=o.streamEvents[t]);return n}},selectAll:function(){}},o.socketURL="/",o.socketMessageEvent="RTCMultiConnection-Message",o.socketCustomEvent="RTCMultiConnection-Custom-Message",o.DetectRTC=DetectRTC,o.setCustomSocketEvent=function(e){e&&(o.socketCustomEvent=e),o.socket&&o.socket.emit("set-custom-socket-event-listener",o.socketCustomEvent)},o.getNumberOfBroadcastViewers=function(e,n){o.socket&&e&&n&&o.socket.emit("get-number-of-users-in-specific-broadcast",e,n)},o.onNumberOfBroadcastViewersUpdated=function(e){o.enableLogs&&o.isInitiator&&console.info("Number of broadcast (",e.broadcastId,") viewers",e.numberOfBroadcastViewers)},o.onUserStatusChanged=function(e,n){o.enableLogs&&!n&&console.info(e.userid,e.status)},o.getUserMediaHandler=R,o.multiPeersHandler=d,o.enableLogs=!0,o.setCustomSocketHandler=function(e){"undefined"!=typeof t&&(t=e)},o.chunkSize=65e3,o.maxParticipantsAllowed=1e3,o.disconnectWith=d.disconnectWith,o.checkPresence=function(e,n){o.socket?o.socket.emit("check-presence",(e||o.sessionid)+"",n):o.connectSocket(function(){o.checkPresence(e,n)})},o.onReadyForOffer=function(e,n){o.multiPeersHandler.createNewPeer(e,n)},o.setUserPreferences=function(e){return o.dontAttachStream&&(e.dontAttachLocalStream=!0),o.dontGetRemoteStream&&(e.dontGetRemoteStream=!0),e},o.updateExtraData=function(){o.socket.emit("extra-data-updated",o.extra)},o.enableScalableBroadcast=!1,o.maxRelayLimitPerUser=3,o.dontCaptureUserMedia=!1,o.dontAttachStream=!1,o.dontGetRemoteStream=!1,o.onReConnecting=function(e){o.enableLogs&&console.info("ReConnecting with",e.userid,"...")},o.beforeAddingStream=function(e){return e},o.beforeRemovingStream=function(e){return e},"undefined"!=typeof M&&(o.checkIfChromeExtensionAvailable=M),"undefined"!=typeof D&&(o.checkIfChromeExtensionAvailable=D),"undefined"!=typeof A&&(o.getChromeExtensionStatus=A),o.getScreenConstraints=function(e,n){m(o,n)&&(n=!0),function(e,n){if("Firefox"===DetectRTC.browser.name)return e(null,{mozMediaSource:"window",mediaSource:"window"});P=null,M(function(t){var o={mandatory:{chromeMediaSource:O,maxWidth:screen.width,maxHeight:screen.height,minWidth:screen.width,minHeight:screen.height,minAspectRatio:U(screen.width,screen.height),maxAspectRatio:U(screen.width,screen.height),minFrameRate:64,maxFrameRate:128},optional:[]};window.IsAndroidChrome?e(null,o):"desktop"!=O||P?("desktop"==O&&(o.mandatory.chromeMediaSourceId=P),P=null,O="screen",E=null,e(null,o)):function(e,n){if(!e)throw'"callback" parameter is mandatory.';if(P)return e(),void(P=null);E=e,n?window.postMessage("audio-plus-tab","*"):window.postMessage("get-sourceId","*")}(function(){o.mandatory.chromeMediaSourceId=P,e("PermissionDeniedError"==P?P:null,o),P=null},n)})}(function(n,t){n||(t=o.modifyScreenConstraints(t),e(n,t))},n)},o.modifyScreenConstraints=function(e){return e},o.onPeerStateChanged=function(e){o.enableLogs&&-1!==e.iceConnectionState.search(/closed|failed/gi)&&console.error("Peer connection is closed between you & ",e.userid,e.extra,"state:",e.iceConnectionState)},o.isOnline=!0,a("online",function(){o.isOnline=!0}),a("offline",function(){o.isOnline=!1}),o.isLowBandwidth=!1,navigator&&navigator.connection&&navigator.connection.type&&(o.isLowBandwidth=-1!==navigator.connection.type.toString().toLowerCase().search(/wifi|cell/g),o.isLowBandwidth)){if(o.bandwidth={audio:!1,video:!1,screen:!1},o.mediaConstraints.audio&&o.mediaConstraints.audio.optional&&o.mediaConstraints.audio.optional.length){var F=[];o.mediaConstraints.audio.optional.forEach(function(e){"undefined"==typeof e.bandwidth&&F.push(e)}),o.mediaConstraints.audio.optional=F}o.mediaConstraints.video&&o.mediaConstraints.video.optional&&o.mediaConstraints.video.optional.length&&(F=[],o.mediaConstraints.video.optional.forEach(function(e){"undefined"==typeof e.bandwidth&&F.push(e)}),o.mediaConstraints.video.optional=F)}o.getExtraData=function(e){if(!e)throw"remoteUserId is required.";return o.peers[e]?o.peers[e].extra:{}},n.autoOpenOrJoin&&o.openOrJoin(o.sessionid),o.onUserIdAlreadyTaken=function(e,n){o.enableLogs&&console.warn("Userid already taken.",e,"Your new userid:",n),o.join(e)},o.onRoomFull=function(e){o.enableLogs&&console.warn(e,"is full.")},o.trickleIce=!0,o.version="3.4.4",o.onSettingLocalDescription=function(e){o.enableLogs&&console.info("Set local description for remote user",e.userid)},o.oneRoomAlreadyExist=function(e){o.enableLogs&&console.info('Server says "Room ',e,"already exist. Joining instead."),o.join(e)},o.resetScreen=function(){P=null,DetectRTC&&DetectRTC.screen&&delete DetectRTC.screen.sourceId,currentUserMediaRequest={streams:[],mutex:!1,queueRequests:[]}},o.autoCreateMediaElement=!0}(this)};